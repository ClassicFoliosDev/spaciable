<% if collection.empty? %>
  <div class="section-actions">
    <%= render 'components/admin/conveyancing', parent: parent %>
  </div>
  <%= render 'components/empty_list', icon_name: "building", type: Plot, parent: parent %>
<% else %>
  <div class="section-actions">
    <%= render 'components/admin/conveyancing', parent: parent %>

    <% if can_create(Plot, current_user.permission_level) %>
      <%= link_to [:new, parent, :plot], class: "btn btn-primary" do %>
        <i class="fa fa-plus"></i>
        <span class="btn-label"><%= t(".add") %></span>
      <% end %>
      <% if parent.crm %>
        <%= link_to phase_import_index_path(parent), class: "btn btn-primary" do %>
          <i ></i>
          <span class="btn-label"><%= t(".sync") %></span>
        <% end %>
      <% end %>
    <% end %>
  </div>

  <%
    country = parent.is_a?(Developer) ? parent.country  : parent.developer.country
    showing_icons = current_user&.cf_admin? ||
                    collection.map { |plot| can? :cas_update, plot }.include?(true)
  %>

  <table class="record-list plots">
    <thead>
      <tr>
        <th><%= sortable(Plot, :number, t(".name")) %></th>
        <th><%= sortable(Plot, :house_number, t(".#{country.name}.house_number")) %></th>
        <th><%= sortable({Plot => Address}, :building_name, t(".#{country.name}.building_name")) %></th>
        <th><%= sortable({Plot => Address}, :road_name, t(".#{country.name}.road_name")) %></th>
        <th><%= sortable({Plot => Address}, :postcode, t(".#{country.name}.postcode")) %></th>
        <% if current_user.cf_admin? || !parent.free? %>
          <th><%= sortable(Plot, :unit_type_id, t(".unit_type")) %></th>
        <% end %>
        <th><%= t(".progress") %></th>
        <th><%= t(".activation") %></th>
        <th><span class="date"><i class="fa fa-question-circle-o" id="plotStatusHelp"></i> <%= sortable(Plot, :completion_release_date, t(".date_c")) %></span></th>
        <% if showing_icons %>
          <th>&nbsp;</th>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% collection.each do |plot| %>
        <tr data-plot="<%= plot.id %>">
          <td><%= link_to_unless (cannot? :read, plot), plot, url_for(plot), title: plot %></td>
          <td><%= plot.house_number %></td>
          <td><%= plot.building_name %></td>
          <td><%= plot.road_name %></td>
          <td><%= plot.postcode %></td>
          <% if current_user.cf_admin? || !parent.free? %>
            <td><%= plot.unit_type %></td>
          <% end %>
          <td><%= plot.build_step_title %></td>
          <td><%= t(".activated", activated: plot.activated_resident_count, all: plot.residents.count) %></td>
          <% comp = "white" %>
          <% if plot.completion_release_date? %>
            <% comp = plot.expired? ? "red" : "green" %>
          <% end %>
          <td><span class = 'circle <%= comp %>'>&nbsp;</span></td>
          <% if showing_icons %>
            <td class="actions">
              <%= edit_btn [:edit, plot], element: plot %>
              <%= delete_btn plot, path: url_for(plot), element: plot %>
            </td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>

  <div class="paging">
    <%= render 'components/page_size' %>
    <%= paginate collection %>
  </div>
<% end %>
