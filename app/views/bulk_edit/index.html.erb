<% breadcrumb :phase_bulk_edit, @phase %>
<script type="text/javascript" src="/javascripts/lib/bulk_edit.js"></script>

<%= render @phase, active_plots_count: @active_plots_count, completed_plots_count: @completed_plots_count,
    expired_plots_count: @expired_plots_count, resident_count: @resident_count,
    activated_resident_count: @activated_resident_count %>

<%= render 'components/tabs', tabs: phase_tabs(@phase, @active_tab, current_user) %>

<div class="section-actions">
    <%= render 'components/admin/conveyancing', parent: @phase %>
</div>

<div class="bulk-edit">
  <%= simple_form_for(:phase_bulk_edit) do |f| %>

    <div class="row">
      <div class="row-item third">
        <div id="why-bulk-edit">
          <button id="whyBulkEditHelp" class="btn dropdown-help-btn" type="button" title="Help">?</button>
          <label> <%= t(".why_title").html_safe %></label>
        </div>
        <div class="why-bulk-edit-help"><br><%= simple_format t(".why") %></div>

        <div id="how-bulk-edit">
          <button id="howBulkEditHelp" class="btn dropdown-help-btn" type="button" title="Help">?</button>
          <label> <%= t(".how_title").html_safe %></label>
        </div>
        <div class="how-bulk-edit-help"><br><%= t(".how").html_safe %></div>

        <%= render "components/admin/plots_select", f: f, all_plots: true, phase_id: @phase.id %>
      </div>

      <div class="row-item third">
        <fieldset>
          <div class="plot-field <%= 'hidden' unless current_user.cf_admin? || (!@phase.free? && @phase.cas) %>">
            <div class="bulk-check fix-checkbox">
              <%= f.hidden_field :ut_update_option, value: UnitType::SUPPLEMENT%>
              <%= f.input_field :unit_type_id_check, as: :boolean, label: false %>
            </div>

            <% lab = unsanitized("<label>#{help_btn text: t('unit_types.collection.plot_template.help'), title: t('unit_types.collection.plot_template.title'), width: 700}#{t('.unit_type')}</label>") %>

            <%= f.input :unit_type_id, label: lab, as: :select, collection: unit_type_collection(@phase) %>
          </div>

          <div class="plot-field">
            <div class="bulk-check fix-checkbox">
              <%= f.input_field :build_step_id_check, as: :boolean, label: false %>
            </div>
            <%= f.input :build_step_id, label: t(".update_progress"), as: :select, collection: all_progress_collection(@phase) %>
          </div>

          <div class="plot-field">
            <div class="bulk-check fix-checkbox">
              <%= f.input_field :completion_date_check, as: :boolean, label: false %>
            </div>
            <%= f.input :completion_date, as: :string, label: t(".comp_date"), placeholder: "DD/MM/YYYY", input_html: { type: :date } %>
          </div>

          <% if current_user.cf_admin? %>
            <%= render "components/admin/plot_date_fields", f: f, plot: nil, phase: @phase %>
          <% end %>
        </fieldset>
      </div>

      <% if @phase.developer.country.spain? %>
        <%= render "components/admin/spanish_plot_address_fields", f: f, plot: nil %>
      <% else %>
        <%= render "components/admin/plot_address_fields", f: f, plot: nil %>
      <% end %>

    </div>

    <div class="form-actions-footer-container">
      <div class="form-actions-footer">
       <%= button_tag "Submit", :type => 'button', class: "btn btn-primary btn-form-submit", id: 'submit-bulk-btn' %>
      </div>
    </div>
  <% end %>
</div>

<div class="ut-update-option-form hidden">
  <%= render 'components/admin/unit_type_update_option_form', header: t(".update_ut").html_safe %>
</div>
