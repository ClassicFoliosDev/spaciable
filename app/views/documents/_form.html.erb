<% doc_parent ||= parent %>
<%= simple_form_for ([parent, document]) do |f| %>
  <% if document.errors.any? %>
    <div class="submission-errors">
      <ul>
        <% document.errors.full_messages.each do |message| %>
          <li>
            <%= fa_icon "exclamation-circle" %>
            <%= message %>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <% guides = guide_collection(document, doc_parent, exclude) %>

  <div class="row documents">
    <div class="row-item third">
      <fieldset>
        <div class="document-container">
          <% unless document.read_only? %>
            <div class="document-file">
              <% if document.persisted? %>
                <%= f.file_field :file, as: :image_preview, input_html: { preview_version: :thumbnail }, class: "file-upload single-file-upload"%>
                <%= label_tag('document_file', t("choose"), class: "choose-file") %>
              <% elsif parent.is_a?(Phase) && parent.free? %>
                <%= f.file_field :files, multiple: false, class: "file-upload" %>
                <%= label_tag(:document_files, t("choose_single"), class: "choose-file choose-files") %>
                <div class="left"><p><%= t(".choose_single_explanation_html").html_safe %></p></div>
              <% else %>
                <%= f.file_field :files, multiple: true, class: "file-upload" %>
                <%= label_tag(:document_files, t("choose_multiple"), class: "choose-file choose-files") %>
                <div class="left"><p><%= t(".choose_multiple_explanation_html").html_safe %></p></div>
                <div class="left hidden" id="multifiles_rename"><p><%= t(".rename_multiples").html_safe %></p></div>
              <% end %>
            </div>
          <% end %>
          <div class="document-title">
            <%= f.label :title, t(".title") %>
            <% unless document.persisted? || (parent.is_a?(Phase) && parent.free?) %>
            <% end %>
            <%= f.input :title, label: false, disabled: document.read_only? %>
          </div>
          <% if document.persisted? %>
            <fieldset>
              <div class="ui-front" id="documentCategorySelector">
                <%= f.input :category, as: :select, collection: category_collection(document), include_blank: false, disabled: document.read_only? %>
              </div><br/>
              <% if guide_selector_valid?(document) %>
                <div class="ui-front" id="documentGuideSelector">
                  <% if !(document.read_only? || guides.length.zero?) %>
                    <%= f.input :guide, label: t(".guide"), as: :select, collection: guide_collection(document, doc_parent, exclude), include_blank: true, disabled: manual_exists(document) %>
                     <br/>
                  <% elsif document.guide %>
                    <label><%= t(".guide") %></label>
                    <p><%= t("activerecord.attributes.document.guides.#{document.guide}") %></p>
                  <% end %>
                </div>
              <% end %>
              <%= f.label :pinned, t(".pinned") %>
              <%= f.check_box :pinned %>
              <p class="checkbox-description"><%= t(".pinned_description") %></p>
              <%= f.label :lau_visible, t(".lau_visible") %>
              <%= f.check_box :lau_visible %>
              <p class="checkbox-description"><%= t(".lau_visible_description") %>
              </p>
              <% if current_user.cf_admin? %>
                <%= f.label :override, t(".override") %>
                <%= f.check_box :override %>
                <p class="checkbox-description"><%= t(".override_description") %></p>
              <% end %>
            </fieldset>
          <% end %>
        </div>
      </fieldset>
    </div>

    <div class="row-item third">
      <% if document.file? && document.errors.none? %>
        <fieldset>
          <% if document.original_filename? %>
            <%= f.label :original_filename, t(".original_name") %>
            <span><%= document.original_filename %></span>
          <% end %>
          <%= f.label :size, t(".size") %>
          <span><%= number_to_human_size(document.file.size) %></span>
          <%= f.label :updated, t(".updated") %>
          <span><%= document.updated_at.strftime("%e %b %Y, %H:%M %p") %></span>
        </fieldset>
      <% else %>
        <fieldset>
          <div class="ui-front" id="documentCategorySelector">
            <%= f.input :category, as: :select, collection: category_collection(document), include_blank: false %>
          </div><br/>
          <% if guide_selector_valid?(document) && !guides.length.zero? %>
            <div class="ui-front" id="documentGuideSelector">
              <%= f.input :guide, label: t(".guide"), as: :select, collection: guide_collection(document, doc_parent, exclude), include_blank: true, disabled: manual_exists(document) %>
              <br/>
            </div>
          <% end %>
          <%= f.label :pinned, t(".pinned") %>
          <%= f.check_box :pinned %>
          <p class="checkbox-description"><%= t(".pinned_description") %></p>
          <%= f.label :lau_visible, t(".lau_visible") %>
          <%= f.check_box :lau_visible %>
          <p class="checkbox-description"><%= t(".lau_visible_description") %></p>
          <% if current_user.cf_admin? %>
            <%= f.label :override, t(".override") %>
            <%= f.check_box :override %>
            <p class="checkbox-description"><%= t(".override_description") %></p>
          <% end %>
        </fieldset>
      <% end %>
    </div>
  </div>

  <div class="form-actions-footer-container">
    <div class="form-actions-footer">
      <%= link_to t(".back"), redirect_path, class: "btn" %>
      <%= f.submit t(".submit"), class: "btn-form-submit btn-primary" %>
      <div class="notify">
        <%= label_tag t(".notify") %>
        <%= f.check_box :notify, checked: action_name == "new" %>
      </div>
    </div>
  </div>
<% end %>
