$(document).on('cocoon:after-insert', function(event, item) {

  // Set the CSS style classes on the selects that we've just added
  $('select').selectmenu();
});

$(document).on('click', '.finish .ui-menu-item', function (event) {

  var optionName = this.innerText;
  var $selectContainer = $(this).closest(".select-container");
  var listClasses = $selectContainer[0].classList;
  var $parentFieldset = $selectContainer.closest(".finish");

  var add_finish = $(document).find(".add_finish");

  if (listClasses.contains("finish_category")) {
    var finishTypeDiv = $parentFieldset.find(".finish_type");
    var finishTypeSelect = clearFields(finishTypeDiv);

    var manufacturerDiv = $parentFieldset.find(".manufacturer");
    clearFields(manufacturerDiv);

    var url = "/finish_types";
    setFields(finishTypeSelect, url, { option_name: optionName });

  } else if (listClasses.contains("finish_type")) {
    var manufacturerDiv = $parentFieldset.find(".manufacturer");
    var manufacturerSelect = clearFields(manufacturerDiv);

    clearFields(manufacturerDiv);

    var url = "/finish_manufacturers";
    var resultCount = setFields(manufacturerSelect, url, { option_name: optionName });

    // Only run through this code if adding an appliance to a room
    // Not when creating a new appliance
  } else if (listClasses.contains("manufacturer") && (add_finish.length > 0)) {
      var $finishesDiv = $parentFieldset.find(".finishes");
      var finishesSelect = clearFields($finishesDiv);

      var $typeDiv = $(".finish_type");
      var typeValue = $typeDiv.find(".ui-selectmenu-text")[0].innerHTML;

      var url = "/finish_list";
      setFields(finishesSelect, url, { type_name: typeValue , manufacturer_name: optionName});
  }
});

function no_manufacturers() {
  //console.log("Found no manufacturers, loading finishes directly from category and type");
  var $parentFieldset = $(document).find(".finish");

  var $finishesDiv = $parentFieldset.find(".finishes");
  var finishesSelect = clearFields($finishesDiv);

  var $typeDiv = $(".finish_type");
  var typeValue = $typeDiv.find(".ui-selectmenu-text")[0].innerHTML;

  var url = "/finish_list";
  setFields(finishesSelect, url, { type_name: typeValue , manufacturer_name: ""});
}
