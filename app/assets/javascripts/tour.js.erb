document.addEventListener('turbolinks:load', function () {
  // check the relevant cookie value
  if ($("#homeownerDashboard").length) {
    $.each(document.cookie.split('; '), function(index, value) {
      if (value.startsWith('dashboard_tour')) {
        if (value.split('=')[1] == "show") {
          loadDashboardTour()
        }
      }
    })
  }
})

$(document).on('click', '.introjs-skipbutton', function () {
  // set the cookie to false with an expiry date in the past
  document.cookie = "dashboard_tour=hide; expires=" + new Date(Date.now() - 86400000)
  console.log(document.cookie)
})

$(document).on('click', '.dashboard-tour-link', function () {
  // set the cookie to false with an expiry date in the past
  document.cookie = "dashboard_tour=show; expires=" + new Date(Date.now() + 86400000)
  console.log(document.cookie)
})

function loadDashboardTour() {
  var tour = introJs()

  tour.setOptions({
    showStepNumbers: false,
    keyboardNavigation: true,
    scrollToElement: true,
    disableInteraction: true,
    exitOnOverlayClick: false,
    exitOnEsc: true,
    nextLabel: "Next",
    prevLabel: "Back",
    skipLabel: "Skip Tour",
    steps: [
      {
        element: ".burger-navigation",
        intro: "<%= I18n.t("tours.intro_tour.navigation") %>",
        position: "left"
      },
      {
        element: ".view-my-home-btn",
        intro: "<%= I18n.t("tours.intro_tour.home") %>",
        position: "top"
      },
      {
        element: ".faqs-component",
        intro: "<%= I18n.t("tours.intro_tour.faq") %>",
        position: "top"
      },
      {
        element: ".contacts-component",
        intro: "<%= I18n.t("tours.intro_tour.contact") %>",
        position: "top"
      },
      {
        element: ".library-component",
        intro: "<%= I18n.t("tours.intro_tour.library").html_safe %>",
        position: "top"
      },
      {
        element: ".perks-component",
        intro: "<%= I18n.t("tours.intro_tour.perks") %>",
        position: "top"
      },
      {
        element: ".services-component",
        intro: "<%= I18n.t("tours.intro_tour.services") %>",
        position: "top"
      },
      {
        element: ".area_guide-component",
        intro: "<%= I18n.t("tours.intro_tour.area_guide") %>",
        position: "top"
      },
      {
        element: ".referrals-component",
        intro: "<%= I18n.t("tours.intro_tour.referrals") %>",
        position: "top"
      },
      {
        element: ".home_designer-component",
        intro: "<%= I18n.t("tours.intro_tour.home_designer") %>",
        position: "top"
      },
      {
        element: ".issues-component",
        intro: "<%= I18n.t("tours.intro_tour.issues") %>",
        position: "top"
      },
      {
        element: ".snagging-component",
        intro: "<%= I18n.t("tours.intro_tour.snagging").html_safe %>",
        position: "top"
      },
      {
        element: ".timeline-component",
        intro: "<%= I18n.t("tours.intro_tour.timeline") %>",
        position: "top"
      },
      {
        element: ".reservation-component",
        intro: "<%= I18n.t("tours.intro_tour.reservation") %>",
        position: "top"
      },
      {
        element: ".completion-component",
        intro: "<%= I18n.t("tours.intro_tour.completion") %>",
        position: "top"
      },
    ].filter(function (obj) {
      return $(obj.element).length
    })
  })

  tour.start()
}
